<!DOCTYPE HTML>
<html>
<head>
<title>Remote Media Center</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="/css/bootstrap.css">
<script src="/js/jquery-3.3.1.js"></script>
<script src="/js/bootstrap.js"></script>
</head>
<body>
	<div class="container">
		<h1>Remote Media Center</h1>
		<div class="row">
			<ul class="nav navbar navbar-left d-flex d-inline-flex">
				<li class="nav-item d-inline-flex  align-items-center mr-2"><a class="nav-link d-inline-flex" href="/index.html">File Explorer</a></li>
				<li class="nav-item d-inline-flex  align-items-center mr-2"><a class="nav-link d-inline-flex" href="/mouseKeyboard.html">Mouse/Keyboard</a></li>
			</ul>
		</div>
		<h2>Mouse/Keyboard</h2>
		<div class="row">
			<img id="screen" src="/screen/shoot" width="100%" height="100%" alt="Unable to load screen"/>
		</div>
	</div>
	<script type = "text/javascript">
	
		var eventBuffer = [];
	
		$('#screen').mousemove(function(e) {
			eventBuffer.push({
				action: 0,
		        x: e.clientX,
		        y: e.clientY,
		        width: parseInt($("#screen").width(), 10),
		        height: parseInt($('#screen').height(), 10),
		        button: -1,
				event: -1
		    });
		});
		
		$('#screen').mousedown(function(event) {
			eventBuffer.push({
				action: 1,
				x: -1,
		        y: -1,
		        width: -1,
		        height: -1,
				button: event.button,
				event: 0
		    });
		});
		
		$('#screen').mouseup(function(event) {
			eventBuffer.push({
				action: 1,
				x: -1,
		        y: -1,
		        width: -1,
		        height: -1,
				button: event.button,
				event: 1
		    });
		});
		
		$(document).keydown(function(event) {
			eventBuffer.push({
				action: 2,
				x: -1,
		        y: -1,
		        width: -1,
		        height: -1,
				button: event.keyCode,
				event: 0
		    });
		});
		
		$(document).keyup(function(event) {
			eventBuffer.push({
				action: 2,
				x: -1,
		        y: -1,
		        width: -1,
		        height: -1,
				button: event.keyCode,
				event: 1
		    });
		});

		
		setInterval(function(){
			if(eventBuffer.length != 0){
				$.ajax({url: "/screen/action", type: "post", contentType: 'application/json', data: JSON.stringify(eventBuffer),
					complete: function(data) {
						$('#screen').attr("src", "/screen/shoot?"+new Date().getTime());
					}
				});
				eventBuffer =[];
			}
		}, 500);
	</script>
</body>
</html>